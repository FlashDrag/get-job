{% extends "base.html" %}
{% load static %}
{% load time_filters %}

{% block content %}
{% include 'jobseeker/navbar.html' %}
<main class="container py-3 px-0 flex-grow-1">
  <div class="card shadow">

    <!-- Job detail header -->
    <div class="card-header">
      <div class="d-flex align-items-center justify-content-between">
        <a href="{% url 'job_search' %}#{{ vacancy.id }}" class="text-decoration-none d-flex align-items-center text-muted fs-4"
          area-label="to search results">
          <i class="fa fa-arrow-left"></i>
          <span class="mx-2">To job search</span>
        </a>
        <div class="d-flex">
          {% if user.is_authenticated and user.role != 'JOBSEEKER' %}
            <span data-bs-toggle="tooltip" data-bs-placement="left" title="Only jobseekers can apply for jobs">
              <button class="btn btn-royalpurple btn-sm px-sm-3 py-1 me-2 disabled">Apply</button>
            </span>
          {% else %}
            <a href="{% url 'job_apply' vacancy.id %}" class="btn btn-royalpurple btn-sm px-sm-3 py-1 me-2">Apply</a>
          {% endif %}
          {% if user.is_authenticated and user.role == 'JOBSEEKER' %}
            <form class="save-job-form" action="{% url 'job_save_toggle' vacancy.id %}" method="post">
              {% csrf_token %}
              <button type="submit"
                class="btn btn-save{% if vacancy.is_saved %}--filled{% endif %} btn-sm btn--royalpurple border royalpurple-border px-sm-3 py-1">
                <span>Save{% if vacancy.is_saved %}d{% endif %}</span>
              </button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="alert alert-royalpurple mb-0">
      <strong>You already applied for this job {{ vacancy.applied_on|timeago }} ago!</strong>
      <!-- TODO my applications -->
      <a class="float-end ms-3" href="">See my applications</a>
    </div>

    <!-- Job detail body -->
    <div class="card-body position-relative py-4 px-3">
      <h2 class="card-title col-8 mb-1 mb-sm-2">{{ vacancy.title }}</h2>
      <p class="col days-counter text-muted">
        <small>{{ vacancy.created_on|timeago }} ago</small>
      </p>

      <!-- Company Image for small screens -->
      <div class="d-sm-none position-absolute top-0 end-0 me-4 mt-3">
        <img src="{% static 'images/company-placeholder.png' %}" class="img-thumbnail" alt="company logo"
          style="max-height: 60px;">
      </div>

      <!-- Main contant -->
      <div class="px-sm-2">
        <!-- List Group -->
        <div class="row">
          <div class="col-12 col-sm-8 px-0">
            <ul class="list-group pb-2 card-list borderless">
              <li class="list-group-item d-flex align-items-end">
                <!-- TODO Clickable with link to detail company info page -->
                <h6 class="list-item-heading my-auto me-sm-4 flex-shrink-0">Company:</h6>
                <p class="my-0 overflow-auto">Company Name</p>
              </li>
              <li class="list-group-item d-flex align-items-end">
                <h6 class="list-item-heading my-auto me-sm-4 flex-shrink-0">Area:</h6>
                <p class="my-0 overflow-auto">{{ vacancy.get_area_display }}</p>
              </li>
              <li class="list-group-item d-flex align-items-end">
                <h6 class="list-item-heading my-auto me-sm-4 flex-shrink-0">Salary:</h6>
                <p class="my-0 overflow-auto">{{ vacancy.salary }}</p>
              </li>
              <li class="list-group-item d-flex align-items-end">
                <h6 class="list-item-heading my-auto me-sm-4 flex-shrink-0">Job type:</h6>
                <p class="my-0 overflow-auto">{{ vacancy.get_job_type_display }}</p>
              </li>
              <li class="list-group-item d-flex align-items-end">
                <h6 class="list-item-heading my-auto me-sm-4 flex-shrink-0">Job location:</h6>
                <p class="my-0 overflow-auto">{{ vacancy.get_job_location_display }}</p>
              </li>
              {% if vacancy.experience %}
              <li class="list-group-item d-flex align-items-end">
                <h6 class="list-item-heading my-auto me-sm-4 flex-shrink-0">Experience:</h6>
                <p class="my-0 overflow-auto">{{ vacancy.experience }}</p>
              </li>
              {% endif %}
            </ul>
          </div>
          <!-- Company Image for large screens -->
          <div class="d-none d-sm-block col-4 mx-auto my-auto text-center">
            <img src="{% static 'images/company-placeholder.png' %}" class="img-thumbnail" alt="company logo"
              style="max-height: 130px;">
          </div>
        </div>

        <!-- Description -->
        <div class="pt-2 px-0">
          <h5>Description:</h5>
          <div>{{ vacancy.body|linebreaks }}</div>
        </div>
      </div>

      <div class="astrodivider">
        <div class="astrodividermask"></div>
      </div>

      <!-- Bottom buttons panel -->
      <div class="d-flex align-items-center justify-content-between px-3 px-sm-4">
        {% if user.is_authenticated and user.role != 'JOBSEEKER' %}
          <span data-bs-toggle="tooltip" data-bs-placement="right" title="Only jobseekers can apply for jobs">
            <button class="btn btn-royalpurple px-3 px-sm-4 py-1 rounded-1 disabled">Apply</button>
          </span>
        {% else %}
          <a href="{% url 'job_apply' vacancy.id %}" class="btn btn-royalpurple px-3 px-sm-4 py-1 rounded-1">Apply</a>
        {% endif %}
        <div class="d-flex fs-3">
          {% if user.is_authenticated and user.role == 'JOBSEEKER' %}
            <form class="save-job-form" action="{% url 'job_save_toggle' vacancy.id %}" method="post">
              {% csrf_token %}
              <button type="submit" aria-label="save job button"
                class="btn-save{% if vacancy.is_saved %}--filled{% endif %} btn--royalpurple card-link me-4">
              </button>
            </form>
          {% endif %}
          <div role="button" class="back-to-top d-flex align-items-center text-royalpurple"
            area-label="scroll to top">
            <i class="fa fa-arrow-up"></i>
          </div>
        </div>
      </div>
    </div>

</main>

{% include 'footer.html' %}
{% endblock %}